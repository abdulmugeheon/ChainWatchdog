Optimize third-party authentication for query (complex)
